<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gap Filler - Home</title>
  <link rel="stylesheet" href="styles.css" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet">
        
  <style>
    .time-selection {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 16px;
      justify-items: stretch;
      align-content: flex-start;
      border: 1px solid #e0e0e0;
      background: linear-gradient(135deg, #ffffff, #f7f9fb);
      width: 650px;
      min-height: 420px;
      padding: 16px;
      border-radius: 16px;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    .time-slot {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      position: relative;
    }

    /* Hide native radio */
    .time-slot input[type="radio"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    /* Pill look for all labels (including custom) */
    .time-slot label {
      display: block;
      width: 100%;
      padding: 10px 8px;
      border-radius: 999px;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 500;
      background-color: #ffffff;
      border: 1px solid #d0d7de;
      color: #333 !important;
      cursor: pointer;
      transition:
        background-color 0.15s ease,
        border-color 0.15s ease,
        box-shadow 0.15s ease,
        transform 0.1s ease;
    }

    .time-slot label:hover {
      background-color: #f0f7ff;
      border-color: #006eb5;
      box-shadow: 0 3px 8px rgba(0, 110, 181, 0.18);
      transform: translateY(-1px);
    }

    /* Selected pill (normal + custom) */
    .time-slot input[type="radio"]:checked + label {
      background-color: #006eb5;
      color: black;
      border-color: #005493;
      box-shadow: 0 4px 10px rgba(0, 110, 181, 0.35);
      transform: translateY(-1px);
    }

    /* Custom time row spans full width */
    .custom-time-slot {
      grid-column: 1 / -1;
      border-top: 1px solid #e0e0e0;
      padding-top: 12px;
      margin-top: 4px;
    }

    .custom-time-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 6px;
    }

    .custom-time-slot select {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #d0d7de;
      background-color: #ffffff;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .custom-time-slot select:focus {
      outline: none;
      border-color: #006eb5;
      box-shadow: 0 0 0 2px rgba(0, 110, 181, 0.2);
    }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }

    .profile-dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
      background-color: white;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
      border-radius: 5px;
      overflow: hidden;
    }

    .dropdown-menu.show {
      display: block;
    }

    .dropdown-item {
      display: block;
      padding: 10px 15px;
      text-decoration: none;
      color: #333;
    }

    .dropdown-item:hover {
      background-color: #f0f0f0;
    }

    .time-wrapper {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

/* Right-side chosen times panel */
.chosen-times {
  margin-top: 13px;
  width: 280px; /* change to whatever you want */
  min-height: 420px; /* matches time-selection height */
  border: 1px solid #d0d7de;
  background: #ffffff;
  padding: 16px;
  border-radius: 16px;
  box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
  font-family: inherit;
}

.chosen-times h3 {
  margin-top: 0;
  font-size: 1.1rem;
  text-align: center;
  color: #333;
}

.selected-pill {
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 999px;
  background: #006eb5;
  color: white;
  cursor: pointer;
  text-align: center;
  border: 1px solid #005493;
  transition: opacity 0.15s ease;
}

.selected-pill:hover {
  opacity: 0.8;
}
    
  </style>
</head>

<body>
  <div class="container">
    <header class="header">
      <a href="index.html" class="logo-link">
        <div class="logo">Gap Filler</div>
      </a>

      <ul class="header-nav">
        <li class="header-nav-item"><a href="index.html">Home</a></li>
        <li class="header-nav-item"><a href="allEvents.html">All Events</a></li>
        <li class="header-nav-item"><a href="addEvent.html">Add Event</a></li>
        <li class="header-nav-item"><a href="pastEvents.html">View Past Events</a></li>
      </ul>

      <div class="header-icons">
        <div class="theme-toggle">
          <input type="checkbox" id="theme-switch" class="theme-switch-input">
          <label for="theme-switch" class="theme-switch-label">
            <span class="theme-icon sun">‚òÄÔ∏è</span>
            <span class="theme-icon moon">üåô</span>
          </label>
        </div>
        <div class="profile-dropdown">
          <button class="icon profile-icon" id="profileButton">
            üë§
          </button>
          <div class="dropdown-menu" id="dropdownMenu">
            <a href="index.html" class="dropdown-item">Logout</a>
          </div>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="breadcrumb-container" id="breadcrumbs">
      </div>

      <div class="questionnaire-container">
        <div class="progress-indicator">
          <div class="progress-circle active" onclick="window.location.href='q1.html'">
            1
          </div>
          <div class="progress-circle" onclick="window.location.href='q2.html'">
            2
          </div>
          <div class="progress-circle" onclick="window.location.href='q3.html'">
            3
          </div>
          <div class="progress-circle" onclick="window.location.href='q4.html'">
            4
          </div>
        </div>

        <h1 class="question-title">When are you free?</h1>

          <div class="time-wrapper">
            <form id="timeForm">
              <div class="time-selection" id="timeSelection"></div>
            </form>

            <div class="chosen-times" id="chosenTimes">
              <h3>Selected Times</h3>
              <div id="chosenList"></div>
            </div>
          </div>


        <div class="nav-buttons">
          <button class="btn-nav btn-previous" onclick="window.location.href='index.html'">
            Home
          </button>
          <button class="btn-nav btn-next" onclick="window.location.href='q2.html'">
            Next
          </button>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-note">
        2025 Gap Filler | COMP 3020 Project Prototype (Group 9)
      </div>
    </footer>
  </div>

  <script>
    const container = document.getElementById("timeSelection");

    function toDisplayLabel(hours24, minutes) {
      let displayHours = ((hours24 + 11) % 12) + 1;
      let ampm = hours24 >= 12 ? "PM" : "AM";
      return `${displayHours}:${minutes.toString().padStart(2, "0")} ${ampm}`;
    }

    // 8:00 AM to 5:30 PM in 30-minute steps
    const startMinutes = 8 * 60;
    const endMinutes = 17 * 60 + 30;

    // Create standard time slots
    for (let i = startMinutes; i <= endMinutes; i += 30) {
      let hours = Math.floor(i / 60);
      let minutes = i % 60;
      let label = toDisplayLabel(hours, minutes);

      const div = document.createElement("div");
      div.className = "time-slot";
      div.innerHTML = `
        <input type="radio" name="time" id="time-${i}" value="${label}">
        <label for="time-${i}">${label}</label>
      `;
      container.appendChild(div);
    }

    function timeToMinutes(t) {
    const [h, m] = t.split(":").map(Number);
    return h * 60 + m;
    }

    // Custom time row at the bottom
    const customDiv = document.createElement("div");
    customDiv.className = "time-slot custom-time-slot";
    customDiv.innerHTML = `
      <input type="radio" name="time" id="time-custom" value="">
      <label id="custom-time-pill" for="time-custom">Custom time</label>
      <div class="custom-time-controls">
        <select id="custom-hour">
          ${Array.from({ length: 12 }, (_, i) => {
            const h = i + 1;
            return `<option value="${h}">${h}</option>`;
          }).join("")}
        </select>
        <span>:</span>
        <select id="custom-minute">
          ${Array.from({ length: 60 }, (_, i) => {
              const m = i.toString().padStart(2, "0");
              return `<option value="${m}">${m}</option>`;
          }).join("")}
        </select>
        <select id="custom-ampm">
          <option value="AM">AM</option>
          <option value="PM">PM</option>
        </select>
      </div>
    `;
    container.appendChild(customDiv);

    const customHour = customDiv.querySelector("#custom-hour");
    const customMinute = customDiv.querySelector("#custom-minute");
    const customAmpm = customDiv.querySelector("#custom-ampm");
    const customTimeRadio = customDiv.querySelector("#time-custom");
    const customTimePill = document.getElementById("custom-time-pill");
    
    function updateCustomTime() {
      const hour = customHour.value;
      const minute = customMinute.value;
      const ampm = customAmpm.value;

      if (!hour || !minute || !ampm) return;

      const formattedMinute = minute.toString().padStart(2, "0");

      const label = `${hour}:${formattedMinute} ${ampm}`;
      customTimeRadio.value = label;

      customTimePill.textContent = `Custom: ${label}`;

      customTimeRadio.checked = true;
    }


    customHour.addEventListener("change", updateCustomTime);
    customMinute.addEventListener("change", updateCustomTime);
    customAmpm.addEventListener("change", updateCustomTime);

    // Dropdown menu logic
    const profileButton = document.getElementById("profileButton");
    const dropdownMenu = document.getElementById("dropdownMenu");

    profileButton.addEventListener("click", function (e) {
      e.stopPropagation();
      dropdownMenu.classList.toggle("show");
    });

    document.addEventListener("click", function (e) {
      if (
        !profileButton.contains(e.target) &&
        !dropdownMenu.contains(e.target)
      ) {
        dropdownMenu.classList.remove("show");
      }
    });

    // Dark Mode Toggle
    const themeSwitch = document.getElementById('theme-switch');
    
    const currentTheme = localStorage.getItem('theme') || 'light';
    if (currentTheme === 'dark') {
        document.body.classList.add('dark-mode');
        themeSwitch.checked = true;
    }
    else {
        document.body.classList.remove('dark-mode');
        themeSwitch.checked = false;
    }
    themeSwitch.addEventListener('change', function() {
        if (this.checked) {
            document.body.classList.add('dark-mode');
            localStorage.setItem('theme', 'dark');
        } else {
            document.body.classList.remove('dark-mode');
            localStorage.setItem('theme', 'light');
        }
    });

    function renderBreadcrumbs() {
      const breadcrumbs = document.getElementById('breadcrumbs');
      if (breadcrumbs) {
        breadcrumbs.innerHTML = `
            <a href="index.html" class="breadcrumb-link">Home</a>
            <span class="breadcrumb-separator">></span>
            <span class="breadcrumb-current">Questionnaire</span>`;
      }
    }
    renderBreadcrumbs();

//---------------------------------------------------------------
// MOVE SELECTED TIMES FROM LEFT ‚Üí RIGHT
// RESTORE THEM WHEN CLICKED FROM RIGHT ‚Üí LEFT
// LIMIT = 4 SELECTIONS
//---------------------------------------------------------------

const chosenList = document.getElementById("chosenList");
const timeSelection = document.getElementById("timeSelection");

// Store original ordering with index position
let originalOrder = new Map(); // id ‚Üí index

// keep track of original times
let allTimes = new Map(); // id ‚Üí { elementHTML, minutes }


// Record original index positions
function cacheOriginalPositions() {
  const slots = Array.from(document.querySelectorAll(".time-slot input"));
  slots.forEach((radio, index) => {
    originalOrder.set(radio.id, index);
  });
}

// ---- Selection Limit ----
function selectedCount() {
  return chosenList.querySelectorAll(".selected-pill").length;
}

// Listen for selecting a time in the left column
timeSelection.addEventListener("change", e => {
  if (e.target.name !== "time") return;

  if (selectedCount() >= 4) {
    // limit reached ‚Üí block selection
    e.target.checked = false;

    // small UX feedback
    chosenList.style.borderColor = "red";
    setTimeout(() => (chosenList.style.borderColor = "#d0d7de"), 800);
    return;
  }

  const radio = e.target;
  const label = radio.value;

  moveTimeToChosen(radio.id, label);
});

function sortChosenList() {
  const pills = Array.from(chosenList.querySelectorAll(".selected-pill"));

  // Convert to objects that contain minutes for sorting
  const parsed = pills.map(p => {
    const label = p.textContent.trim(); // e.g. "8:30 AM"
    const minutes = convertLabelToMinutes(label);
    return { element: p, minutes };
  });

  // Sort numerically
  parsed.sort((a, b) => a.minutes - b.minutes);

  // Re-append in sorted order
  parsed.forEach(item => chosenList.appendChild(item.element));
}

// Convert "8:30 AM" ‚Üí 510
function convertLabelToMinutes(label) {
  const [time, ampm] = label.split(" ");
  let [hour, minute] = time.split(":").map(Number);

  if (ampm === "PM" && hour !== 12) hour += 12;
  if (ampm === "AM" && hour === 12) hour = 0;

  return hour * 60 + minute;
}


function moveTimeToChosen(id, label) {
  const slot = document.getElementById(id)?.parentElement;
  if (slot) slot.remove();

  const div = document.createElement("div");
  div.className = "selected-pill";
  div.dataset.id = id;
  div.textContent = label;

  chosenList.appendChild(div);
  sortChosenList();
  saveChosenTimes();   
}


function saveChosenTimes() {
  const labels = Array.from(
    chosenList.querySelectorAll(".selected-pill")
  ).map(p => p.textContent.trim());

  localStorage.setItem("chosenTimes", JSON.stringify(labels));
}

function restoreChosenTimes() {
  const saved = JSON.parse(localStorage.getItem("chosenTimes") || "[]");

  if (!saved.length) return;

  saved.forEach(label => {
    // Find the matching left slot
    const radio = Array.from(
      timeSelection.querySelectorAll('input[name="time"]')
    ).find(r => r.value === label);

    if (radio) {
      // move to chosen list
      moveTimeToChosen(radio.id, label);
    } else {
      // custom time case
      // custom time case ‚Üí always use the real custom-time element
      moveTimeToChosen("time-custom", label);

      // update custom pill UI
      customTimePill.textContent = `Custom: ${label}`;
      customTimeRadio.value = label;

          }
  });

  sortChosenList();
}


chosenList.addEventListener("click", e => {
  if (!e.target.classList.contains("selected-pill")) return;

  const removedLabel = e.target.textContent.trim();

  // Remove from UI
  const id = e.target.dataset.id;
  restoreToLeft(id);
  e.target.remove();

  // Remove from localStorage immediately
  let saved = JSON.parse(localStorage.getItem("chosenTimes") || "[]");
  saved = saved.filter(t => t !== removedLabel);
  localStorage.setItem("chosenTimes", JSON.stringify(saved));
});


// Restore deselected time to ORIGINAL index position
function restoreToLeft(id) {
  const index = originalOrder.get(id);
  if (index === undefined) return;

  const html = allTimes.get(id);
  const wrapper = document.createElement("div");
  wrapper.innerHTML = html;
  const restoredSlot = wrapper.firstElementChild;

  const currentSlots = Array.from(timeSelection.querySelectorAll(".time-slot"));
  if (index >= currentSlots.length) {
    timeSelection.appendChild(restoredSlot);
  } else {
    timeSelection.insertBefore(restoredSlot, currentSlots[index]);
  }

  const radio = restoredSlot.querySelector("input");
  if (radio) radio.checked = false;
  if (id === "time-custom") {
    // Do NOT restore custom time into the left column
    // Instead, reset the custom pill
    customTimeRadio.checked = false;
    customTimeRadio.value = "";
    customTimePill.textContent = "Custom time";
    return;
}

  saveChosenTimes();     // ‚òÖ persist
}


  // Cache original HTML for each time-slot
function cacheOriginalTimes() {
  const slots = Array.from(document.querySelectorAll(".time-slot"));
  slots.forEach(slot => {
    const input = slot.querySelector("input");
    allTimes.set(input.id, slot.outerHTML);
  });
}
cacheOriginalTimes();
cacheOriginalPositions();
restoreChosenTimes();



  </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gap Filler - Home</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .time-selection {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 16px;
      justify-items: stretch;
      align-content: flex-start;
      border: 1px solid #e0e0e0;
      background: linear-gradient(135deg, #ffffff, #f7f9fb);
      width: 650px;
      min-height: 420px;
      padding: 16px;
      border-radius: 16px;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    .time-slot {
      display: flex;
      flex-direction: column;
      align-items: stretch;
      position: relative;
    }

    /* Hide native radio */
    .time-slot input[type="radio"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    /* Pill look for all labels (including custom) */
    .time-slot label {
      display: block;
      width: 100%;
      padding: 10px 8px;
      border-radius: 999px;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 500;
      background-color: #ffffff;
      border: 1px solid #d0d7de;
      color: #333;
      cursor: pointer;
      transition:
        background-color 0.15s ease,
        border-color 0.15s ease,
        box-shadow 0.15s ease,
        transform 0.1s ease;
    }

    .time-slot label:hover {
      background-color: #f0f7ff;
      border-color: #006eb5;
      box-shadow: 0 3px 8px rgba(0, 110, 181, 0.18);
      transform: translateY(-1px);
    }

    /* Selected pill (normal + custom) */
    .time-slot input[type="radio"]:checked + label {
      background-color: #006eb5;
      color: #ffffff;
      border-color: #005493;
      box-shadow: 0 4px 10px rgba(0, 110, 181, 0.35);
      transform: translateY(-1px);
    }

    /* Custom time row spans full width */
    .custom-time-slot {
      grid-column: 1 / -1;
      border-top: 1px solid #e0e0e0;
      padding-top: 12px;
      margin-top: 4px;
    }

    .custom-time-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 6px;
    }

    .custom-time-slot select {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #d0d7de;
      background-color: #ffffff;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .custom-time-slot select:focus {
      outline: none;
      border-color: #006eb5;
      box-shadow: 0 0 0 2px rgba(0, 110, 181, 0.2);
    }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }

    .profile-dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
      background-color: white;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
      border-radius: 5px;
      overflow: hidden;
    }

    .dropdown-menu.show {
      display: block;
    }

    .dropdown-item {
      display: block;
      padding: 10px 15px;
      text-decoration: none;
      color: #333;
    }

    .dropdown-item:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="header">
      <a href="index.html" class="logo-link">
        <div class="logo">Gap Filler</div>
      </a>

      <ul class="header-nav">
        <li class="header-nav-item"><a href="index.html">Home</a></li>
        <li class="header-nav-item"><a href="allEvents.html">All Events</a></li>
        <li class="header-nav-item"><a href="addEvent.html">Add Event</a></li>
        <li class="header-nav-item"><a href="pastEvents.html">View Past Events</a></li>
      </ul>

      <div class="header-icons">
        <div class="theme-toggle">
          <input type="checkbox" id="theme-switch" class="theme-switch-input">
          <label for="theme-switch" class="theme-switch-label">
            <span class="theme-icon sun">‚òÄÔ∏è</span>
            <span class="theme-icon moon">üåô</span>
          </label>
        </div>
        <div class="profile-dropdown">
          <button class="icon profile-icon" id="profileButton">
            üë§
          </button>
          <div class="dropdown-menu" id="dropdownMenu">
            <a href="index.html" class="dropdown-item">Logout</a>
          </div>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="breadcrumb-container" id="breadcrumbs">
      </div>

      <div class="questionnaire-container">
        <div class="progress-indicator">
          <div class="progress-circle active" onclick="window.location.href='q1.html'">
            1
          </div>
          <div class="progress-circle" onclick="window.location.href='q2.html'">
            2
          </div>
          <div class="progress-circle" onclick="window.location.href='q3.html'">
            3
          </div>
          <div class="progress-circle" onclick="window.location.href='q4.html'">
            4
          </div>
        </div>

        <h1 class="question-title">When are you free?</h1>

        <form id="timeForm">
          <div class="time-selection" id="timeSelection"></div>
        </form>

        <div class="nav-buttons">
          <button class="btn-nav btn-previous" onclick="window.location.href='index.html'">
            Home
          </button>
          <button class="btn-nav btn-next" onclick="window.location.href='q2.html'">
            Next
          </button>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-note">
        2025 Gap Filler | COMP 3020 Project Prototype (Group 9)
      </div>
    </footer>
  </div>

  <script>
    const container = document.getElementById("timeSelection");

    function toDisplayLabel(hours24, minutes) {
      let displayHours = ((hours24 + 11) % 12) + 1;
      let ampm = hours24 >= 12 ? "PM" : "AM";
      return `${displayHours}:${minutes.toString().padStart(2, "0")} ${ampm}`;
    }

    // 8:00 AM to 5:30 PM in 30-minute steps
    const startMinutes = 8 * 60;
    const endMinutes = 17 * 60 + 30;

    // Create standard time slots
    for (let i = startMinutes; i <= endMinutes; i += 30) {
      let hours = Math.floor(i / 60);
      let minutes = i % 60;
      let label = toDisplayLabel(hours, minutes);

      const div = document.createElement("div");
      div.className = "time-slot";
      div.innerHTML = `
        <input type="radio" name="time" id="time-${i}" value="${label}">
        <label for="time-${i}">${label}</label>
      `;
      container.appendChild(div);
    }

    // Custom time row at the bottom
    const customDiv = document.createElement("div");
    customDiv.className = "time-slot custom-time-slot";
    customDiv.innerHTML = `
      <input type="radio" name="time" id="time-custom" value="">
      <label id="custom-time-pill" for="time-custom">Custom time</label>
      <div class="custom-time-controls">
        <select id="custom-hour">
          ${Array.from({ length: 12 }, (_, i) => {
            const h = i + 1;
            return `<option value="${h}">${h}</option>`;
          }).join("")}
        </select>
        <span>:</span>
        <select id="custom-minute">
          ${Array.from({ length: 60 }, (_, i) => {
              const m = i.toString().padStart(2, "0");
              return `<option value="${m}">${m}</option>`;
          }).join("")}
        </select>
        <select id="custom-ampm">
          <option value="AM">AM</option>
          <option value="PM">PM</option>
        </select>
      </div>
    `;
    container.appendChild(customDiv);

    const customHour = customDiv.querySelector("#custom-hour");
    const customMinute = customDiv.querySelector("#custom-minute");
    const customAmpm = customDiv.querySelector("#custom-ampm");
    const customTimeRadio = customDiv.querySelector("#time-custom");
    const customTimePill = document.getElementById("custom-time-pill");
    
    function updateCustomTime() {
      const hour = customHour.value;
      const minute = customMinute.value;
      const ampm = customAmpm.value;

      if (!hour || !minute || !ampm) return;

      const formattedMinute = minute.toString().padStart(2, "0");

      const label = `${hour}:${formattedMinute} ${ampm}`;
      customTimeRadio.value = label;

      customTimePill.textContent = `Custom: ${label}`;

      customTimeRadio.checked = true;
      localStorage.setItem("selectedTime", label);
    }


    customHour.addEventListener("change", updateCustomTime);
    customMinute.addEventListener("change", updateCustomTime);
    customAmpm.addEventListener("change", updateCustomTime);

    // Save selected time whenever any radio is clicked
    container.addEventListener("change", function (e) {
      if (e.target.name === "time") {
        const value = e.target.value;

        // If custom radio clicked without a full time set, ignore
        if (e.target.id === "time-custom") {
          const hour = customHour.value;
          const minute = customMinute.value;
          const ampm = customAmpm.value;
          if (!hour || !minute || !ampm) {
            e.target.checked = false;
            return;
          }
        }

        localStorage.setItem("selectedTime", value);
      }
    });

    // Restore previously selected time from localStorage
    const savedTime = localStorage.getItem("selectedTime");
    if (savedTime) {
      const radio = document.querySelector(
        `input[name="time"][value="${savedTime}"]`
      );

      if (radio) {
        radio.checked = true;
      } else {
        // Not one of the preset slots -> treat as custom
        const match = savedTime.match(/^(\d{1,2}):(\d{2})\s(AM|PM)$/);
        if (match) {
          const [, hStr, mStr, ampmStr] = match;
          const h = Math.min(Math.max(parseInt(hStr, 10), 1), 12);
          customHour.value = h.toString();
          customMinute.value = mStr;
          customAmpm.value = ampmStr;
        }
        customTimeRadio.value = savedTime;
        customTimeRadio.checked = true;
        customTimePill.textContent = `Custom: ${savedTime}`;
      }
    }

    // Dropdown menu logic
    const profileButton = document.getElementById("profileButton");
    const dropdownMenu = document.getElementById("dropdownMenu");

    profileButton.addEventListener("click", function (e) {
      e.stopPropagation();
      dropdownMenu.classList.toggle("show");
    });

    document.addEventListener("click", function (e) {
      if (
        !profileButton.contains(e.target) &&
        !dropdownMenu.contains(e.target)
      ) {
        dropdownMenu.classList.remove("show");
      }
    });

    // Theme switch log
    const themeSwitch = document.getElementById("theme-switch");
    themeSwitch.addEventListener("change", function () {
      console.log("Theme toggle clicked:", this.checked ? "Dark" : "Light");
    });

    function renderBreadcrumbs() {
      const breadcrumbs = document.getElementById('breadcrumbs');
      if (breadcrumbs) {
        breadcrumbs.innerHTML = `
            <a href="index.html" class="breadcrumb-link">Home</a>
            <span class="breadcrumb-separator">></span>
            <span class="breadcrumb-current">Questionnaire</span>`;
      }
    }
    renderBreadcrumbs();
  </script>
</body>

</html>